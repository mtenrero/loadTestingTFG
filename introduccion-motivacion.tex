\cleardoublepage
\chapter{Introducción y Motivación}
\label{sec:intro} % etiqueta para poder referenciar luego en el texto con ~\ref{sec:intro}
\pagenumbering{arabic} % para empezar la numeración de página con números

La última era de la informática no ha parado de evolucionar durante las últimas décadas, han surgido y se han puesto en práctica diversas metodologías en el desarrollo del software, desde el modelo de procesos hasta las más actuales como las denominadas metodologías ágiles, formadas por una serie de técnicas y de métodos como Extreme Programming , Kanban o Scrum.

En la actualidad, el uso de las metodologías ágiles está en auge, y esto conlleva la adopción de una nueva manera de concebir la informática, dando prioridad a fases que antes no se tenían en cuenta, como es el caso de la fase de testing.

En el mundo del desarrollo del software, el testing, es quizás, una de las partes más importantes del ciclo, ya que permiten asegurar la estabilidad del producto entre las diferentes iteraciones del desarrollo.  

Dentro de esta etapa, existen diversos tipos de pruebas a realizar, pero este trabajo de fin de grado se centra  en las pruebas de rendimiento.

En términos de calidad de software, a la hora de realizar un test, se tiene muy en cuenta la pirámide de test, la cual pretende dar unas guías generales a tener en cuenta con respecto a la cantidad de test que se deberían desarrollar para un proyecto, teniendo en cuenta su complejidad de codificación y mantenimiento.

Normalmente se sitúan en la cima esta pirámide los tests de sistema o End-To-End (E2E) ya que el coste de éstos es muy elevado al requerir que todos los componentes de la aplicación se encuentren operativos en el momento de realización de las pruebas y al ser más frágiles. Los test de rendimiento se encuentran justo en esta cima.  

El análisis del rendimiento que ofrece una aplicación es crucial para poder comprobar que ésta escala de una manera apropiada con diferentes cargas de trabajo. Normalmente, es un aspecto que se suele olvidar en las etapas iniciales del desarrollo, ya que es un factor que suele preocupar más en aplicaciones que ya tienen una considerable carga.

No solo es una etapa relegada debido a que no suele ser un factor preocupante en las primeras iteraciones del desarrollo, sino que también resulta complicado el establecer una infraestructura para poder ejecutar, y sobre todo, mantener este tipo de tests.


Este trabajo cubre la realización de una herramienta de ayuda en el proceso del análisis de rendimiento de cualquier aplicación. Pretende ofrecer una manera sencilla de ejecutar estos test de manera automática y distribuida sin tener que preocuparse de la infraestructura subyacente necesaria. 

Normalmente, con los test de rendimiento se pretende simular una gran carga de trabajo sobre la aplicación y esto se traduce en muchas conexiones simultáneas a la misma, y para ello, se necesitan diversos nodos para poder distribuir esta simulación de carga. 


\clearpage

La parte mas tediosa de trabajar con diversos nodos es la configuración de éstos para que estén preparados para realizar su cometido. 

Por ello, para una efectiva gestión, es necesario poder desplegar y ejecutar estos tests de manera sencilla, y la única manera de hacerlo ágilmente, es contemplar el paradigma de cloud computing, que aporta el concepto de contenedores y un despliegue rápido de infraestructura bajo demanda.

La herramienta que se ha desarrollado durante la realización de este trabajo de fin de grado añade una capa de abstracción a la tecnología de orquestación de contenedores por excelencia, Docker. Lo que se traduce en la posibilidad de ejecutar cualquier tipo de aplicación que requiera este modelo de despliegue, aunque como ejemplo, se ha tomado como referencia la herramienta Apache JMeter.

Por otra parte, llevo cerca de dos años trabajando en el departamento de automatización y calidad de software en una empresa multinacional de desarrollo de software, estando estos valores y premisas muy presentes en mi vida laboral. En los últimos meses, el análisis de rendimiento ha sido un objetivo muy importante en esta empresa, y mi labor se ha centrado en gran medida en esta tarea, diseñando y desplegando toda la infraestructura necesaria para poner en práctica el proyecto. 

Este hecho me ha permitido probar en primera línea los avances sobre mi trabajo de fin de grado en un entorno empresarial real. 

\section{Despliegue tradicional de Apache JMeter}

Apache JMeter tiene diversos modos de funcionamiento, ya que ofrece dos interfaces, una gráfica y otra por línea de comandos. Para aprovechar varios nodos y poder lanzar un test de carga de forma distribuida, es necesario ejecutar la aplicación en modo nodo esclavo en cada uno de los nodos remotos en los que se va a ejecutar el test.\newline

Por otro lado, estos nodos deben estar visibles entre sí dentro de la red, lo que implica una configuración manual del firewall para poder así abrir los puertos necesarios.\newline

Un despliegue típico consistiría en los siguientes pasos:

\subsubsection{Descarga de Apache JMeter}
Bien via repositorio de paquetes \textit{Debian} o \textit{Red-Hat based} o vía fichero comprimido con los binarios pre-compilados por la fundación Apache.\newline

Como ejemplo se va usar una distribución CentOS 7, basada en RedHat utilizando los binarios disponibles desde la página oficial de JMeter.

\begin{lstlisting}[language=bash]
  $ wget https://archive.apache.org/dist/jmeter/binaries/ \
  apache-jmeter-3.3.zip
  $ unzip jmeter-3.3.zip
\end{lstlisting}  

Con estos comandos se dispondría de los binarios de JMeter preparados para ser ejecutados en prácticamente cualquier sistema UNIX.

\subsubsection{Configuración del firewall}

JMeter requiere que el firewall esté correctamente configurado para permitir la comunicación entre nodos, esto implica la apertura de diversos puertos como \textbf{1099},\textbf{1664} entre otros, ya que depende de la configuración que se realice sobre JMeter. 

Dependiendo de la distribución sobre la que realizar las configuraciones, se usará un comando u otro, los más típicos son los siguientes:

\textbf{Ubuntu UFW}

\begin{lstlisting}[language=bash]
  $ ufw allow <port>/tcp
\end{lstlisting}

\textbf{IP Tables}

\begin{lstlisting}[language=bash]
  $ iptables -A INPUT -p tcp --dport <port> -j ACCEPT
\end{lstlisting}

\textbf{Firewall-cmd}

\begin{lstlisting}[language=bash]
  $ firewall-cmd --zone=public --add-port=<port>/tcp --permanent
\end{lstlisting}

Tratar con la complejidad de la configuración del firewall y de la red se vuelve realmente complejo y más cuando se dispone de una gran cantidad de nodos y éstos son heterogéneos en lo que a Sistema Operativo se refiere.

\subsubsection{Despliegue de esclavos}

Apache JMeter requiere de un orden de arranque específico, primero deben arrancarse los nodos esclavos con el siguiente comando:

\begin{lstlisting}[language=bash]
  $ ./jmeter-server -Dserver.rmi.localport=4445 -Dserver_port=1099 
\end{lstlisting}

Este comando debe ser ejecutado en cada uno de los nodos que vayan a ser empleados como esclavos. 

\subsubsection{Arranque del nodo Maestro}

Es necesario manejar y actualizar constantemente la lista de las direcciones de los nodos a los que que conectarse a través del nodo maestro para ejecutar un test de carga distribuido ya que es necesario especificar explícitamente los nodos remotos.\newline

Para ejecutar un test de carga distribuido, una vez que la infraestructura previa está correctamente configurada, basta con ejecutar un comando similar al siguiente:

\begin{lstlisting}[language=bash]
  $ ./jmeter -n -t $TEST_PATH -R$REMOTES -Dserver.rmi.localport=60000 
\end{lstlisting}

\subsubsection{Publicación de resultados}

Es posible especificar un \textbf{\textit{Listener}} durante la ejecución del nodo maestro junto al test para así poder exportar en tiempo real los resultados del test a un sistema externo como \textit{Apache Kafka}, \textit{ElasticSearch}, una base de datos entre otros.

\subsubsection{Consideraciones adicionales: Cifrado de comunicaciones}

Es común utilizar un cifrado SSL o TLS en las comunicaciones de red, y JMeter permite encriptar las comunicaciones entre los diferentes nodos con SSL\footnote{https://jmeter.apache.org/usermanual/remote-test.html\#setup\_ssl}. Esto requiere de la generación de certificados y de un almacén de claves, lo que dificulta, aun mas, el despliegue de un clúster de forma tradicional.